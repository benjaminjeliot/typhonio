!
! tiof_vargroup_test.pf
!

!=======================================================================================================================

subroutine test_tio_list_vargroups_f

  use pfunit_mod
  use typhonio
  implicit none

  integer :: ierr
  character(len=*), parameter :: file_name = "./tio_files/tio_vargroup.h5"
  character(len=TIO_STRLEN_F) :: code_name
  character(len=TIO_STRLEN_F) :: version
  character(len=TIO_STRLEN_F) :: date
  character(len=TIO_STRLEN_F) :: title
  integer(kind=TIO_FILEK) :: file_id
  integer(kind=TIO_OBJK) :: state_id
  integer(kind=TIO_SIZEK) :: nobj
  character(len=TIO_STRLEN_F), dimension(3) :: names

  ierr = TIO_Open_f(file_name, file_id, TIO_ACC_READONLY_F, code_name, version, date, title)
  @assertEqual(TIO_SUCCESS_F, ierr)
  ierr = TIO_Open_State_f(file_id, "State1", state_id)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  ierr = TIO_List_Vargroups_f(file_id, state_id, nobj=nobj)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  @assertEqual( 3, nobj )
  
  ierr = TIO_List_Vargroups_f(file_id, state_id, names=names)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  !@assertEqual( (/ "VarGroup1", "VarGroup2", "VarGroup3" /), names )
  @assertEqual( "VarGroup1", names(1) )
  @assertEqual( "VarGroup2", names(2) )
  @assertEqual( "VarGroup3", names(3) )

end subroutine test_tio_list_vargroups_f

!=======================================================================================================================

subroutine test_tio_create_vargroup_f

  use pfunit_mod
  use typhonio
  implicit none

  integer :: ierr
  character(len=*), parameter :: file_name = "tio_create_vargroup.h5"
  integer(kind=TIO_FILEK) :: file_id
  integer(kind=TIO_OBJK) :: state_id
  integer(kind=TIO_OBJK) :: mesh_id
  integer(kind=TIO_OBJK) :: vargroup_id

  ierr = TIO_Create_f(file_name, file_id, TIO_ACC_REPLACE_F, "TestCode", "V0.0", "01-01-2000", "Test Title")
  @assertEqual(TIO_SUCCESS_F, ierr)
  ierr = TIO_Create_State_f( file_id, "State1", state_id, 1, 0.0_TIO_TIMEK, "seconds" )
  @assertEqual(TIO_SUCCESS_F, ierr)

  ierr = TIO_Create_Vargroup_f(file_id, state_id, "VarGroup1", vargroup_id)
  @assertEqual(TIO_SUCCESS_F, ierr)

end subroutine test_tio_create_vargroup_f

!=======================================================================================================================

subroutine test_tio_open_vargroup_f

  use pfunit_mod
  use typhonio
  implicit none

  integer :: ierr
  character(len=*), parameter :: file_name = "./tio_files/tio_vargroup.h5"
  character(len=TIO_STRLEN_F) :: code_name
  character(len=TIO_STRLEN_F) :: version
  character(len=TIO_STRLEN_F) :: date
  character(len=TIO_STRLEN_F) :: title
  integer(kind=TIO_FILEK) :: file_id
  integer(kind=TIO_OBJK) :: state_id
  integer(kind=TIO_OBJK) :: vargroup_id

  ierr = TIO_Open_f(file_name, file_id, TIO_ACC_READONLY_F, code_name, version, date, title)
  @assertEqual(TIO_SUCCESS_F, ierr)
  ierr = TIO_Open_State_f(file_id, "State1", state_id)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  ierr = TIO_Open_Vargroup_f(file_id, state_id, "VarGroup1", vargroup_id)
  @assertEqual(TIO_SUCCESS_F, ierr)

end subroutine test_tio_open_vargroup_f

!=======================================================================================================================

subroutine test_tio_open_vargroup_idx_f

  use pfunit_mod
  use typhonio
  implicit none

  integer :: ierr
  character(len=*), parameter :: file_name = "./tio_files/tio_vargroup.h5"
  character(len=TIO_STRLEN_F) :: code_name
  character(len=TIO_STRLEN_F) :: version
  character(len=TIO_STRLEN_F) :: date
  character(len=TIO_STRLEN_F) :: title
  character(len=TIO_STRLEN_F) :: vargroup_name
  integer(kind=TIO_FILEK) :: file_id
  integer(kind=TIO_OBJK) :: state_id
  integer(kind=TIO_OBJK) :: vargroup_id

  ierr = TIO_Open_f(file_name, file_id, TIO_ACC_READONLY_F, code_name, version, date, title)
  @assertEqual(TIO_SUCCESS_F, ierr)
  ierr = TIO_Open_State_f(file_id, "State1", state_id)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  ierr = TIO_Open_Vargroup_idx_f(file_id, state_id, 1, vargroup_name, vargroup_id)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  @assertEqual( "VarGroup1", vargroup_name )

end subroutine test_tio_open_vargroup_idx_f

!=======================================================================================================================

subroutine test_tio_get_vargroup_info_f

  use pfunit_mod
  use typhonio
  implicit none

  integer :: ierr
  character(len=*), parameter :: file_name = "./tio_files/tio_vargroup.h5"
  character(len=TIO_STRLEN_F) :: code_name
  character(len=TIO_STRLEN_F) :: version
  character(len=TIO_STRLEN_F) :: date
  character(len=TIO_STRLEN_F) :: title
  character(len=TIO_STRLEN_F) :: vargroup_name
  integer(kind=TIO_FILEK) :: file_id
  integer(kind=TIO_OBJK) :: state_id
  integer(kind=TIO_OBJK) :: vargroup_id

  ierr = TIO_Open_f(file_name, file_id, TIO_ACC_READONLY_F, code_name, version, date, title)
  @assertEqual(TIO_SUCCESS_F, ierr)
  ierr = TIO_Open_State_f(file_id, "State1", state_id)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  ierr = TIO_Open_Vargroup_f(file_id, state_id, "VarGroup1", vargroup_id)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  ierr = TIO_Get_Vargroup_Info_f(file_id, vargroup_id, vargroup_name)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  @assertEqual( "VarGroup1", vargroup_name )

end subroutine test_tio_get_vargroup_info_f

!=======================================================================================================================

subroutine test_tio_close_vargroup_f

  use pfunit_mod
  use typhonio
  implicit none

  integer :: ierr
  character(len=*), parameter :: file_name = "./tio_files/tio_vargroup.h5"
  character(len=TIO_STRLEN_F) :: code_name
  character(len=TIO_STRLEN_F) :: version
  character(len=TIO_STRLEN_F) :: date
  character(len=TIO_STRLEN_F) :: title
  integer(kind=TIO_FILEK) :: file_id
  integer(kind=TIO_OBJK) :: state_id
  integer(kind=TIO_OBJK) :: vargroup_id

  ierr = TIO_Open_f(file_name, file_id, TIO_ACC_READONLY_F, code_name, version, date, title)
  @assertEqual(TIO_SUCCESS_F, ierr)
  ierr = TIO_Open_State_f(file_id, "State1", state_id)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  ierr = TIO_Open_Vargroup_f(file_id, state_id, "VarGroup1", vargroup_id)
  @assertEqual(TIO_SUCCESS_F, ierr)
  
  ierr = TIO_Close_Vargroup_f(file_id, vargroup_id)
  @assertEqual(TIO_SUCCESS_F, ierr)

end subroutine test_tio_close_vargroup_f

!=======================================================================================================================
